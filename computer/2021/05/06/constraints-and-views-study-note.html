<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-translate-customization" content="108d9124921d80c3-80e20d618ff053c8-g4f02ec6f3dba68b7-c">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Constraints and Views Study Note | Yuchen’s Blog</title>
<meta name="generator" content="Jekyll v3.9.2">
<meta property="og:title" content="Constraints and Views Study Note">
<meta name="author" content="Yuchen Zhang">
<meta property="og:locale" content="en_US">
<meta name="description" content="Constraints Kinds of Constraints Keys Primary Key vs Unique Foreign Keys Express Foreign Key with Attribute Express Foreign Key as Element Express Foreign Key with Unique Attributes Enforcing Foreign Key Constraints Dealing with Enforcing Foreign Key Constraints Value-based constraints Attribute-Based Checks Timing of Attribute-Based Checks Tuple-based Checks Assertions (Not Supported in MySQL) Timing of Assertion Checks Views What Happens When a View Is Used? DMBS Optimization Types of Views">
<meta property="og:description" content="Constraints Kinds of Constraints Keys Primary Key vs Unique Foreign Keys Express Foreign Key with Attribute Express Foreign Key as Element Express Foreign Key with Unique Attributes Enforcing Foreign Key Constraints Dealing with Enforcing Foreign Key Constraints Value-based constraints Attribute-Based Checks Timing of Attribute-Based Checks Tuple-based Checks Assertions (Not Supported in MySQL) Timing of Assertion Checks Views What Happens When a View Is Used? DMBS Optimization Types of Views">
<link rel="canonical" href="https://anthonyive.github.io/blog/computer/2021/05/06/constraints-and-views-study-note.html">
<meta property="og:url" content="https://anthonyive.github.io/blog/computer/2021/05/06/constraints-and-views-study-note.html">
<meta property="og:site_name" content="Yuchen’s Blog">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-05-06T00:00:00+00:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Constraints and Views Study Note">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Yuchen Zhang"},"dateModified":"2021-05-06T00:00:00+00:00","datePublished":"2021-05-06T00:00:00+00:00","description":"Constraints Kinds of Constraints Keys Primary Key vs Unique Foreign Keys Express Foreign Key with Attribute Express Foreign Key as Element Express Foreign Key with Unique Attributes Enforcing Foreign Key Constraints Dealing with Enforcing Foreign Key Constraints Value-based constraints Attribute-Based Checks Timing of Attribute-Based Checks Tuple-based Checks Assertions (Not Supported in MySQL) Timing of Assertion Checks Views What Happens When a View Is Used? DMBS Optimization Types of Views","headline":"Constraints and Views Study Note","mainEntityOfPage":{"@type":"WebPage","@id":"https://anthonyive.github.io/blog/computer/2021/05/06/constraints-and-views-study-note.html"},"url":"https://anthonyive.github.io/blog/computer/2021/05/06/constraints-and-views-study-note.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="shortcut icon" href="">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-noto-sans@0.0.72/index.min.css">
  <link rel="stylesheet" href="/blog/assets/css/main.css">
  <script src="/blog/assets/js/main.js"></script><link type="application/atom+xml" rel="alternate" href="https://anthonyive.github.io/blog/feed.xml" title="Yuchen's Blog">
<script>
  function initGoogleAnalytics() {
    var doNotTrack = (window.doNotTrack === "1" || navigator.doNotTrack === "1" ||
      navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1");
    var enableDNT = "false" == "true";

    if (!enableDNT || !doNotTrack) {
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-199968139-1', 'auto');
      ga('send', 'pageview');
    }
  }
  window.addEventListener("load", initGoogleAnalytics);
</script>

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
<!-- and it's easy to individually load additional languages -->
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/go.min.js"></script>



















<script>
// Init highlight js
document.addEventListener('DOMContentLoaded', function(event) {
  var els = document.querySelectorAll('pre code')

  function addLangData(block) {
    var outer = block.parentElement.parentElement.parentElement;
    var lang = block.getAttribute('data-lang');
    for (var i = 0; i < outer.classList.length; i++) {
      var cls = outer.classList[i];
      if (cls.startsWith('language-')) {
        lang = cls;
        break;
      }
    }
    if (!lang) {
      cls = block.getAttribute('class');
      lang = cls ? cls.replace('hljs ', '') : '';
    }
    if (lang.startsWith('language-')) {
      lang = lang.substr(9);
    }
    block.setAttribute('class', 'hljs ' + lang);
    block.parentNode.setAttribute('data-lang', lang);
  }

  function addBadge(block) {
    var enabled = ('true' || 'true').toLowerCase();
    if (enabled == 'true') {
      var pre = block.parentElement;
      pre.classList.add('badge');
    }
  }

  function handle(block) {
    addLangData(block);
    addBadge(block)
    hljs.highlightBlock(block);
  }

  for (var i = 0; i < els.length; i++) {
    var el = els[i];
    handle(el);
  }
});
</script>

<style>
  /* code language badge */
  pre.badge::before {
    content: attr(data-lang);
    color: #fff;
    background-color: #ff4e00;
    padding: 0 .5em;
    border-radius: 0 2px;
    text-transform: uppercase;
    text-align: center;
    min-width: 32px;
    display: inline-block;
    position: absolute;
    right: 0;
  }

  /* fix wrong badge display for firefox browser */
  code > table pre::before {
    display: none;
  }
</style>
</head>
<body>



























































































































<header class="site-header " role="banner">

  <div class="wrapper">
    <div class="site-header-inner">
<span class="site-brand"><a class="site-brand-inner" rel="author" href="/blog/">
  <img class="site-favicon" title="Yuchen's Blog" src="" onerror="this.style.display='none'">
  Yuchen's Blog
</a>
</span><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger">
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewbox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
              </svg>
            </span>
          </label>

          <div class="trigger">
<a class="page-link" href="/blog/about.html">ABOUT</a><a class="page-link" href="/blog/archives.html">ARCHIVES</a><a class="page-link" href="/blog/categories.html">CATEGORIES</a><a class="page-link" href="/blog/tags.html">TAGS</a>




</div>
        </nav>
</div>
  </div>
</header>

<script>
  function initHeader() {
    var lastScrollY = getScrollPos().y;
    var documentElement = document.documentElement;

    function storeScrollData() {
      var y = getScrollPos().y;var scrollStatus = "";

      if (y <= 0) {
        scrollStatus = "top";
      } else if ((window.innerHeight + y) >= document.body.offsetHeight) {
        scrollStatus = "bottom";
      } else {
        var isScrollDown = (y - lastScrollY > 0) ? true : false;
        scrollStatus = isScrollDown ? "down" : "up";
      }

      lastScrollY = y;
      documentElement.setAttribute("data-scroll-status", scrollStatus);
    }

    window.addEventListener('scroll', function(e) {
      storeScrollData();
    });

    storeScrollData();
  }
  document.addEventListener('DOMContentLoaded', initHeader);
</script>
















































































































































<script>
  function hashLocate(hashValue) {
    hashValue = hashValue.replace(/^.*#h-/, '');
    hashValue = decodeURIComponent(hashValue);
    var element = document.getElementById(hashValue);

    if (!element) {
      return;
    }

    var header = document.querySelector('header.site-header');
    var headerRect = header.getBoundingClientRect();
    var headerTop = Math.floor(headerRect.top);
    var headerHeight = Math.floor(headerRect.height);
    var scrollPos = getScrollPos();
    var offsetY = element.offsetTop - (headerTop + headerHeight + 20);

    if (offsetY == scrollPos.y) {
      return;
    }

    if (headerTop == 0  && offsetY > scrollPos.y) {
      offsetY += headerHeight + 2;
    } else if (headerTop < 0  && offsetY < scrollPos.y) {
      offsetY -= headerHeight - 2;
    }

    smoothScrollTo(offsetY);
  }

  // The first event occurred
  window.addEventListener('load', function(event) {
    if (window.location.hash) {
      hashLocate(window.location.hash);
    }
  });

  // The first event occurred
  window.addEventListener('click', function(event) {
    if (event.target.tagName.toLowerCase() == 'a') {
      hashLocate(event.target.getAttribute('href'));
    }
  });
</script>
<div class="theme-toggle">
  <input type="checkbox" id="theme-switch">
  <label for="theme-switch">
    <div class="toggle"></div>
    <div class="names">
      <p class="light">Light</p>
      <p class="dark">Dark</p>
    </div>
  </label>
</div>




<script>
  (function() {
    var sw = document.getElementById('theme-switch');
    var html = document.getElementsByTagName('html')[0];
    var nightModeOption = ('auto' || 'auto').toLowerCase();
    var storage = nightModeOption === 'manual'
        ? localStorage
        : sessionStorage;
    var themeData = loadThemeData();

    function saveThemeData(data) {
      storage.setItem('theme', JSON.stringify(data));
    }

    function loadThemeData() {
      var data = storage.getItem('theme');
      try {
        data = JSON.parse(data ? data : '');
      } catch(e) {
        data = { nightShift: undefined, autoToggleAt: 0 };
        saveThemeData(data);
      }
      return data;
    }

    function handleThemeToggle(nightShift) {
      themeData.nightShift = nightShift;
      saveThemeData(themeData);
      html.dataset.theme = nightShift ? 'dark' : 'light';
      setTimeout(function() {
        sw.checked = nightShift ? true : false;
      }, 50);
    }

    function autoThemeToggle() {
      // Next time point of theme toggle
      var now = new Date();
      var toggleAt = new Date();
      var hours = now.getHours();
      var nightShift = hours >= 19 || hours <=7;

      if (nightShift) {
        if (hours > 7) {
          toggleAt.setDate(toggleAt.getDate() + 1);
        }
        toggleAt.setHours(7);
      } else {
        toggleAt.setHours(19);
      }

      toggleAt.setMinutes(0);
      toggleAt.setSeconds(0);
      toggleAt.setMilliseconds(0)

      var delay = toggleAt.getTime() - now.getTime();

      // auto toggle theme mode
      setTimeout(function() {
        handleThemeToggle(!nightShift);
      }, delay);

      return {
        nightShift: nightShift,
        toggleAt: toggleAt.getTime()
      };
    }

    // Listen the theme toggle event
    sw.addEventListener('change', function(event) {
      handleThemeToggle(event.target.checked);
    });

    if (nightModeOption == 'auto') {
      var data = autoThemeToggle();

      // Toggle theme by local setting
      if (data.toggleAt > themeData.autoToggleAt) {
        themeData.autoToggleAt = data.toggleAt;
        handleThemeToggle(data.nightShift);
      } else {
        handleThemeToggle(themeData.nightShift);
      }
    } else if (nightModeOption == 'manual') {
      handleThemeToggle(themeData.nightShift);
    } else {
      var nightShift = themeData.nightShift;
      if (nightShift === undefined) {
        nightShift = nightModeOption === 'on';
      }
      handleThemeToggle(nightShift);
    }
  })();
</script>
<div id="click-to-top" class="click-to-top">
  <i class="fa fa-arrow-up"></i>
</div>
<script>
  (function () {
    const clickToTop = document.getElementById('click-to-top');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 100) {
        clickToTop.classList.add('show')
      }else {
        clickToTop.classList.remove('show')
      }
    });
    clickToTop.addEventListener('click', () => {
      window.smoothScrollTo(0);
    });
  })();
</script>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="framework">
  <section class="main">

     <div class="post">
  <section>









<header class="post-header">
  <h1 class="post-title p-name" itemprop="name headline">Constraints and Views Study Note</h1>
  <h2 class="post-subtitle"></h2>

  <p class="post-meta">
    <time class="dt-published" datetime="2021-05-06T00:00:00+00:00" itemprop="datePublished"><i class="fa fa-calendar"></i> May 6, 2021
    </time>

    
    
































    <span class="post-reading-time left-vsplit"><i class="fa fa-clock-o"></i> About 11 mins</span>
  </p>
<div class="post-tags">
<a class="post-tag" href="/blog/tags.html#study-notes">#study-notes</a><a class="post-tag" href="/blog/tags.html#constraints">#constraints</a><a class="post-tag" href="/blog/tags.html#views">#views</a>
</div></header>
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="post-content e-content" itemprop="articleBody">

      <ul>
  <li>
<a href="#constraints">Constraints</a>
    <ul>
      <li><a href="#kinds-of-constraints">Kinds of Constraints</a></li>
      <li>
<a href="#keys">Keys</a>
        <ul>
          <li><a href="#primary-key-vs-unique">Primary Key vs Unique</a></li>
        </ul>
      </li>
      <li>
<a href="#foreign-keys">Foreign Keys</a>
        <ul>
          <li><a href="#express-foreign-key-with-attribute">Express Foreign Key with Attribute</a></li>
          <li><a href="#express-foreign-key-as-element">Express Foreign Key as Element</a></li>
          <li><a href="#express-foreign-key-with-unique-attributes">Express Foreign Key with Unique Attributes</a></li>
          <li><a href="#enforcing-foreign-key-constraints">Enforcing Foreign Key Constraints</a></li>
          <li><a href="#dealing-with-enforcing-foreign-key-constraints">Dealing with Enforcing Foreign Key Constraints</a></li>
        </ul>
      </li>
      <li>
<a href="#value-based-constraints">Value-based constraints</a>
        <ul>
          <li>
<a href="#attribute-based-checks">Attribute-Based Checks</a>
            <ul>
              <li><a href="#timing-of-attribute-based-checks">Timing of Attribute-Based Checks</a></li>
            </ul>
          </li>
          <li><a href="#tuple-based-checks">Tuple-based Checks</a></li>
          <li>
<a href="#assertions-not-supported-in-mysql">Assertions (Not Supported in MySQL)</a>
            <ul>
              <li><a href="#timing-of-assertion-checks">Timing of Assertion Checks</a></li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
<a href="#views">Views</a>
    <ul>
      <li><a href="#what-happens-when-a-view-is-used">What Happens When a View Is Used?</a></li>
      <li><a href="#dmbs-optimization">DMBS Optimization</a></li>
      <li><a href="#types-of-views">Types of Views</a></li>
    </ul>
  </li>
</ul>

<h2 id="constraints">Constraints</h2>

<h3 id="kinds-of-constraints">Kinds of Constraints</h3>

<ul>
  <li>Keys</li>
  <li>Foreign-key, or referential-integrity</li>
  <li>Value-based constraints
    <ul>
      <li>Constrain values of a particular attribute</li>
    </ul>
  </li>
  <li>Tuple-based constraints
    <ul>
      <li>Constrain relationship among attributes</li>
    </ul>
  </li>
  <li>Assertions: any SQL boolean expression
    <ul>
      <li>Very expressive</li>
    </ul>
  </li>
</ul>

<h3 id="keys">Keys</h3>

<p>Specified using “primary key” or “unique”:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Sells</span><span class="p">(</span>
    <span class="n">bar</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Bars</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
    <span class="n">beer</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Beers</span><span class="p">(</span><span class="n">name</span><span class="p">),</span>
    <span class="n">price</span> <span class="nb">REAL</span><span class="p">,</span>
    <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">(</span><span class="n">bar</span><span class="p">,</span> <span class="n">beer</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<h4 id="primary-key-vs-unique">Primary Key vs Unique</h4>

<ul>
  <li>Referenced attributes must be declared as <code class="language-plaintext highlighter-rouge">PRIMARY KEY</code> or <code class="language-plaintext highlighter-rouge">UNIQUE</code>.
    <ul>
      <li>Otherwise, MySQL does not allow creation of the table</li>
      <li>Note that primary key can not be null, but unique attribute can</li>
    </ul>
  </li>
  <li>Null values can be inserted into attribute of foreign key
    <ul>
      <li>Even though it refers to primary key in referenced table</li>
    </ul>
  </li>
</ul>

<h3 id="foreign-keys">Foreign Keys</h3>

<p>Use the keyword <code class="language-plaintext highlighter-rouge">REFERENCES</code>, either:</p>

<ol>
  <li>Within the declaration of an attribute, when only
one attribute is involved, or</li>
  <li>As an element of the schema, as:
FOREIGN KEY ( &lt;list of attributes&gt; ) REFERENCES &lt;relation&gt; ( &lt;attributes&gt; )</li>
</ol>

<ul>
  <li>Note MySQL seems to enforce Foreign Key only when defined as an element</li>
</ul>

<h4 id="express-foreign-key-with-attribute">Express Foreign Key with Attribute</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Beers</span> <span class="p">(</span>
    <span class="n">name</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">manf</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Sells</span> <span class="p">(</span>
    <span class="n">bar</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">beer</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">Beers</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> 
    <span class="n">price</span> <span class="nb">REAL</span> <span class="p">);</span>
</code></pre></div></div>

<h4 id="express-foreign-key-as-element">Express Foreign Key as Element</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Beers</span> <span class="p">(</span>
    <span class="n">name</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
    <span class="n">manf</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Sells</span> <span class="p">(</span>
    <span class="n">bar</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">beer</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">price</span> <span class="nb">REAL</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">beer</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">BEERS</span><span class="p">(</span><span class="n">name</span><span class="p">));</span> <span class="c1">-- here name must be primary key</span>
</code></pre></div></div>

<h4 id="express-foreign-key-with-unique-attributes">Express Foreign Key with Unique Attributes</h4>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">R</span> <span class="p">(</span><span class="n">a</span> <span class="nb">INT</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">);</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">R</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">R</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+---+
| a |
+---+
| 1 |
+---+
1 row in set (0.00 sec)
</code></pre></div></div>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">S</span> <span class="p">(</span><span class="n">b</span> <span class="nb">INT</span><span class="p">,</span> <span class="k">FOREIGN</span> <span class="k">KEY</span> <span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">R</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">S</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">1</span><span class="p">);</span>    <span class="c1">-- this works because "a" in R has number 1</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">S</span> <span class="k">VALUES</span> <span class="p">(</span><span class="k">NULL</span><span class="p">);</span> <span class="c1">-- this also works even though "a" is primary key in R</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">S</span> <span class="k">VALUES</span> <span class="p">(</span><span class="mi">2</span><span class="p">);</span>    <span class="c1">-- this doesn't work because "a" in R doesn't have number 2</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">S</span><span class="p">;</span>
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>+------+
| b    |
+------+
| NULL |
|    1 |
+------+
2 rows in set (0.00 sec)
</code></pre></div></div>

<h4 id="enforcing-foreign-key-constraints">Enforcing Foreign Key Constraints</h4>

<p>If there is a foreign-key constraint from attributes of relation S to the primary key (or unique attribute) of relation R, two violations are possible:</p>

<ol>
  <li>An insert or update to S introduces values not found in R.</li>
  <li>A deletion or update to R causes some tuples of S to “dangle.”</li>
</ol>

<h4 id="dealing-with-enforcing-foreign-key-constraints">Dealing with Enforcing Foreign Key Constraints</h4>

<p>Example: Suppose R = Beers, S = Sells.</p>

<ul>
  <li>An insert or update to Sells that introduces a nonexistent beer must be rejected.</li>
  <li>A deletion or update to Beers that removes a beer value found in some tuples of Sells can be handled in three ways.
    <ol>
      <li>
<em>Default</em>: Reject the modification</li>
      <li>
<em>Cascade</em>: Make the same changes in Sells.
        <ul>
          <li>Deleted beer: delete Sells tuple.</li>
          <li>Updated beer: change value in Sells.</li>
        </ul>
      </li>
      <li>
<em>Set NULL</em>: Change the beers in Sells to <code class="language-plaintext highlighter-rouge">NULL</code>.</li>
    </ol>
  </li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Sells</span> <span class="p">(</span>
    <span class="n">bar</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">beer</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">price</span> <span class="nb">REAL</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">beer</span><span class="p">)</span>
        <span class="k">REFERENCES</span> <span class="n">Beers</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="k">ON</span> <span class="k">DELETE</span> <span class="k">SET</span> <span class="k">NULL</span>   <span class="c1">-- set on delete separately with its type</span>
        <span class="k">ON</span> <span class="k">UPDATE</span> <span class="k">CASCADE</span> <span class="p">);</span> <span class="c1">-- set on update separately with its type</span>
</code></pre></div></div>

<h3 id="value-based-constraints">Value-based constraints</h3>

<h4 id="attribute-based-checks">Attribute-Based Checks</h4>

<p>Make sure every insertion of age is smaller than 100:</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">student</span> <span class="p">(</span>
    <span class="n">age</span> <span class="nb">TINYINT</span> <span class="k">CHECK</span> <span class="p">(</span><span class="n">age</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<p>Make sure every insertion of beer is in the names of Beers table and price is smaller than or equal to 5.00.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Sells</span> <span class="p">(</span>
    <span class="n">bar</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">beer</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">CHECK</span> <span class="p">(</span> <span class="n">beer</span> <span class="k">IN</span>
        <span class="p">(</span><span class="k">SELECT</span> <span class="n">name</span> <span class="k">FROM</span> <span class="n">Beers</span><span class="p">)),</span>
        <span class="c1">-- Does not checked if a beer is deleted </span>
        <span class="c1">-- from Beers (unlike foreign-keys).</span>
    <span class="n">price</span> <span class="nb">REAL</span> <span class="k">CHECK</span> <span class="p">(</span> <span class="n">price</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">.</span><span class="mi">00</span> <span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<h5 id="timing-of-attribute-based-checks">Timing of Attribute-Based Checks</h5>

<p>An attribute-based check is checked only when a value for that attribute is inserted or updated.</p>

<ul>
  <li>Example: CHECK (price &lt;= 5.00) checks every new price and rejects it if it is more than $5.</li>
  <li>Example: CHECK (beer IN (SELECT name FROM Beers)) not checked if a beer is deleted from Beers (unlike foreign-keys).</li>
</ul>

<h4 id="tuple-based-checks">Tuple-based Checks</h4>

<ul>
  <li>CHECK ( &lt;condition&gt; ) may be added as another element of a schema definition.</li>
  <li>The condition may refer to any attribute of the relation, but any other attributes or relations require a subquery.</li>
  <li>Checked on insert or update only.</li>
</ul>

<p>Example: If we want only Joe’s Bar can sell beer for more than $5.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Sells</span> <span class="p">(</span>
    <span class="n">bar</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">beer</span> <span class="nb">CHAR</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span>
    <span class="n">price</span> <span class="nb">REAL</span><span class="p">,</span>
    <span class="k">CHECK</span> <span class="p">(</span><span class="n">bar</span> <span class="o">=</span> <span class="s1">'Joe'</span> <span class="k">OR</span> <span class="n">price</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">.</span><span class="mi">00</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<h4 id="assertions-not-supported-in-mysql">Assertions (Not Supported in MySQL)</h4>

<ul>
  <li>These are database-schema elements, like relations or views.</li>
  <li>Defined by:<code class="language-plaintext highlighter-rouge">CREATE ASSERTION &lt;name&gt; CHECK ( &lt;condition&gt; );</code>
</li>
  <li>Condition may refer to any relation or attribute in the database schema.</li>
  <li>Very expensive to enforce
    <ul>
      <li>Neither PostgreSQL nor MySQL supports this</li>
    </ul>
  </li>
</ul>

<p>Example: In Sells(bar, beer, price), bars cannot charge an average of more than $5.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">ASSERTION</span> <span class="n">NoRipoffBars</span> <span class="k">CHECK</span> <span class="p">(</span>
    <span class="k">NOT</span> <span class="k">EXISTS</span> <span class="p">(</span>
        <span class="k">SELECT</span> <span class="n">bar</span> <span class="k">FROM</span> <span class="n">Sells</span>
        <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">bar</span>
        <span class="k">HAVING</span> <span class="mi">5</span><span class="p">.</span><span class="mi">00</span> <span class="o">&lt;</span> <span class="k">AVG</span><span class="p">(</span><span class="n">price</span><span class="p">)</span>
<span class="p">));</span>
</code></pre></div></div>

<p>Example: In Drinkers(name, addr, phone) and Bars(name, addr, license), there cannot be more bars than drinkers.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">ASSERTION</span> <span class="n">FewBar</span> <span class="k">CHECK</span> <span class="p">(</span>
    <span class="p">(</span><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">Bars</span><span class="p">)</span> <span class="o">&lt;=</span>
    <span class="p">(</span><span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">Drinkers</span><span class="p">)</span>
<span class="p">);</span>
</code></pre></div></div>

<h5 id="timing-of-assertion-checks">Timing of Assertion Checks</h5>

<ul>
  <li>In principle, we must check every assertion after every modification to any relation of the database.</li>
  <li>A clever system can observe that only certain changes could cause a given assertion to be violated.
    <ul>
      <li>Example: No change to Beers can affect FewBar. Neither can an insertion to Drinkers.</li>
    </ul>
  </li>
</ul>

<h2 id="views">Views</h2>

<ul>
  <li>A view is a “virtual table,” a relation that is defined in terms of the contents of other tables and views.</li>
  <li>Declare by: <code class="language-plaintext highlighter-rouge">CREATE VIEW &lt;name&gt; AS &lt;query&gt;;</code>
</li>
  <li>In contrast, a relation whose value is really stored in the database is called a base table.</li>
</ul>

<p>Example: CanDrink(drinker, beer) is a view “containing” the drinker-beer pairs such that the drinker frequents at least one bar that serves the beer.</p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">VIEW</span> <span class="n">CanDrink</span> <span class="k">AS</span>
<span class="k">SELECT</span> <span class="k">distinct</span> <span class="n">drinker</span><span class="p">,</span> <span class="n">beer</span>
<span class="k">FROM</span> <span class="n">Frequents</span><span class="p">,</span> <span class="n">Sells</span>
<span class="k">WHERE</span> <span class="n">Frequents</span><span class="p">.</span><span class="n">bar</span> <span class="o">=</span> <span class="n">Sells</span><span class="p">.</span><span class="n">bar</span><span class="p">;</span>
</code></pre></div></div>

<p>Example: Accessing a View</p>

<ul>
  <li>You may query a view as if it were a base table.
    <ul>
      <li>There is a limited ability to modify views if the modification makes sense as a modification of the underlying base table.</li>
    </ul>
  </li>
</ul>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">CanDrink</span>
<span class="k">WHERE</span> <span class="n">drinker</span> <span class="o">=</span> <span class="s1">'Bill'</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="what-happens-when-a-view-is-used">What Happens When a View Is Used?</h3>

<ul>
  <li>The DBMS starts by interpreting the query as if the view were a base table.
    <ul>
      <li>Typical DBMS turns the query into something like relational algebra.</li>
    </ul>
  </li>
  <li>The queries defining any views used by the query are also replaced by their algebraic equivalents, and “spliced into” the expression tree for the query.</li>
</ul>

<h3 id="dmbs-optimization">DMBS Optimization</h3>

<ul>
  <li>It is interesting to observe that the typical DBMS will then “optimize” the query by transforming the algebraic expression to one that can be executed faster.</li>
  <li>Key optimizations:
    <ol>
      <li>Push selections down the tree.</li>
      <li>Eliminate unnecessary projections.</li>
    </ol>
  </li>
</ul>

<figure id="figure-1"><a onclick="ga('send', 'event', { 'eventCategory': 'Figure', 'eventAction': 'View', 'eventLabel': 'view-optimization'});" href="/blog/assets/figures/view-optimization.png"><img src="/blog/assets/figures/view-optimization.png" alt="Optimization"></a><figcaption>Figure 1: Optimization [<a onclick="ga('send', 'event', { 'eventCategory': 'Figure', 'eventAction': 'View', 'eventLabel': 'view-optimization'});" href="/blog/assets/figures/view-optimization.png">PNG</a>]</figcaption></figure>

<h3 id="types-of-views">Types of Views</h3>

<ul>
  <li>Virtual views:
    <ul>
      <li>Computed only on-demand – slow at runtime</li>
      <li>Always up to date</li>
    </ul>
  </li>
  <li>Materialized views
    <ul>
      <li>Precomputed offline – fast at runtime</li>
      <li>Common in data warehouses</li>
      <li>May have stale data</li>
    </ul>
  </li>
</ul>


    </div>

</article>
<div class="post-nav">
<a class="previous" href="/blog/computer/2021/05/05/sql-study-note.html" title="SQL Study Note">SQL Study Note</a><a class="next" href="/blog/computer/2021/05/06/er-model-study-note.html" title="ER Model Study Note">ER Model Study Note</a>
</div>
<div class="post-related">
      <div>Related Articles</div>
      <ul>
        <li><a class="post-link" href="/blog/computer/2021/05/07/data-representation-and-external-sorting-study-note.html" title="ER Model Study Note">Data Representation &amp; External Sorting Study Note</a></li>
<li><a class="post-link" href="/blog/project/2021/03/28/DSCI-550-Paper-Review-Apache-Lucene-4.html" title="ER Model Study Note">Paper Review: Apache Lucene 4</a></li>
<li><a class="post-link" href="/blog/computer/2021/04/19/query-execution-study-note.html" title="ER Model Study Note">Query Execution Study Note</a></li>
<li><a class="post-link" href="/blog/computer/2021/05/06/er-model-study-note.html" title="ER Model Study Note">ER Model Study Note</a></li>
</ul>
    </div>
<div class="post-comments">  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://anthonyive.github.io/blog/computer/2021/05/06/constraints-and-views-study-note.html';
      this.page.identifier = 'https://anthonyive.github.io/blog/computer/2021/05/06/constraints-and-views-study-note.html';
    };

    (function() {
      var d = document, s = d.createElement('script');

      s.src = 'https://blog-g49frf6rg4.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
</div></section>
</div>


  </section>
  <section class="sidebar" style="margin-left: 15px;">
    <!-- Get sidebar items --><style type="text/css" media="screen">
.post-menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
</style>

<div class="post-menu">
  <div class="post-menu-title">TOC</div>
  <div class="post-menu-content"></div>
</div>

<script>
  function generateContent() {
    var menu = document.querySelector(".post-menu");
    var menuContent =  menu.querySelector(".post-menu-content");
    var headings = document.querySelector(".post-content").querySelectorAll("h2, h3, h4, h5, h6");

    // Hide menu when no headings
    if (headings.length === 0) {
      return menu.style.display = "none";
    }

    // Generate post menu
    var menuHTML = '';
    for (var i = 0; i < headings.length; i++) {
      var h = headings[i];
      menuHTML += (
        '<li class="h-' + h.tagName.toLowerCase() + '">'
        + '<a href="#h-' + h.getAttribute('id') + '">' + h.textContent + '</a></li>');
    }

    menuContent.innerHTML = '<ul>' + menuHTML + '</ul>';

    // The header element
    var header = document.querySelector('header.site-header');

    function doMenuCollapse(index, over_items) {
      var items = menuContent.firstChild.children;

      if (over_items == undefined) {
        over_items = 20;
      }

      if (items.length < over_items) {
        return;
      }

      var activeItem = items[index];
      var beginItem = activeItem
      var endItem = activeItem
      var beginIndex = index;
      var endIndex = index + 1;
      while (beginIndex >= 0
        && !items[beginIndex].classList.contains('h-h2')) {
        beginIndex -= 1;
      }
      while (endIndex < items.length
        && !items[endIndex].classList.contains('h-h2')) {
        endIndex += 1;
      }
      for (var i = 0; i < beginIndex; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
      for (var i = beginIndex + 1; i < endIndex; i++) {
        item = items[i]
        // if (!item.classList.contains('h-h2')) {
          item.style.display = '';
        // }
      }
      for (var i = endIndex; i < items.length; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
    }

    // Init menu collapsed
    doMenuCollapse(-1);

    // Active the menu item
    window.addEventListener('scroll', function (event) {
      var lastActive = menuContent.querySelector('.active');
      var changed = true;
      var activeIndex = -1;
      for (var i = headings.length - 1; i >= 0; i--) {
        var h = headings[i];
        var headingRect = h.getBoundingClientRect();
        var headerRect = header.getBoundingClientRect();
        var headerTop = Math.floor(headerRect.top);
        var headerHeight = Math.floor(headerRect.height);
        var headerHeight = headerTop + headerHeight + 20;
        if (headingRect.top <= headerHeight) {
          var id = 'h-' + h.getAttribute('id');
          var a = menuContent.querySelector('a[href="#' + id  + '"]');
          var curActive = a.parentNode;
          if (curActive) {
            curActive.classList.add('active');
            activeIndex = i;
          }
          if (lastActive == curActive) {
            changed = false;
          }
          break;
        }
      }
      if (changed) {
        if (lastActive) {
          lastActive.classList.remove('active');
        }
        doMenuCollapse(activeIndex);
      }
      event.preventDefault();
    });
  }
  generateContent();
</script>
</section>
</div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/blog/"></data>

  <div class="wrapper">
    <div class="site-footer-inner">
<div>Copyright © 2021</div>
      <div>Powered by <a title="Jekyll is a simple, blog-aware, static site
      generator." href="https://jekyllrb.com/">Jekyll</a> &amp; <a title="Yat, yet
      another theme." href="https://github.com/jeffreytse/jekyll-theme-yat">Yat Theme</a>.</div>
      <div class="footer-col rss-subscribe">Subscribe <a href="/blog/feed.xml">via RSS</a>
</div>
    </div>
  </div>
</footer>
</body>
</html>
